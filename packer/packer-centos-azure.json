{
  "variables": {
    "subscription_id": "{{ env `AZURE_SUBSCRIPTION_ID` }}",
    "client_id": "{{ env `AZURE_CLIENT_ID` }}",
    "client_secret": "{{ env `AZURE_CLIENT_SECRET` }}",
    "image_name": "{{ env `AZURE_IMAGE_NAME` }}", 
    "target_resource_group": "{{ env `AZURE_TARGET_RESOURCE_GROUP` }}",
    "image_sku": "{{ env `AZURE_IMAGE_SKU` }}",
    "vm_size": "{{ env `AZURE_VM_SIZE` }}"
  },
  "builders": [{
    "type": "azure-arm",
    "subscription_id": "{{ user `subscription_id` }}",
    "client_id": "{{ user `client_id` }}",
    "client_secret": "{{ user `client_secret` }}",
    "image_publisher": "OpenLogic",
    "image_offer": "CentOS",
    "image_sku": "{{ user `image_sku` }}",
    "managed_image_name": "{{ user `image_name` }}-{{timestamp}}",
    "managed_image_resource_group_name": "{{ user `target_resource_group` }}",
    "build_resource_group_name": "{{ user `target_resource_group` }}",
    "azure_tags": {
      "owner": "caravan-backing",
      "managedBy": "packer",
      "repo": "github.com/bitrockteam/caravan-baking"
    },
    "os_type": "Linux",
    "os_disk_size_gb": 30,
    "ssh_username": "centos",
    "vm_size": "{{ user `vm_size` }}"
  }],
  "provisioners": [
    {
      "type": "ansible",
      "playbook_file": "../ansible/centos-azure.yml",
      "groups": ["centos_azure"],
      "inventory_directory": "../ansible"
    },
    {
      "type": "shell",
      "script": "scripts/centos-cleanup.sh"
    },
    {
      "inline": "sudo reboot",
      "type": "shell",
      "expect_disconnect": true
    }
  ]
}
